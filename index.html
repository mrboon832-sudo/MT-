<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Mamphi ‚ù§Ô∏è</title>
<style>
/* =========================
   THEME & BASE
   ========================= */
:root{ --bg:#fdf6f9; --text:#222; --accent:#ff4d6d; --heart-pink:#ff85a1; --card-bg: rgba(0,0,0,0.04); }
body.dark{ --bg:#081426; --text:#fff; --accent:#ff85a1; --heart-pink:#ff85a1; --card-bg: rgba(255,255,255,0.03); }
body{
  margin:0; font-family: Arial, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
  -webkit-touch-callout:none; overflow:hidden; /* keep UI panelized, no page scroll */
}

/* small utilities */
.center { display:flex; justify-content:center; align-items:center; }

/* =========================
   BACKGROUND LAYERS
   - sunset (light) and night (dark) layers
   - particles container for hearts/stars
   ========================= */
.bg-layer{ position:fixed; inset:0; z-index:-20; pointer-events:none; }
.bg-sunset{ position:absolute; inset:0; background: linear-gradient(180deg,#ffd6d6 0%,#ffefd9 35%,#ffd1c1 70%); transition:opacity .3s; opacity:1; }
.bg-night{ position:absolute; inset:0; background: linear-gradient(180deg,#081426 0%, #021024 60%); transition:opacity .3s; opacity:0; }

.particles{ position:fixed; inset:0; z-index:-10; pointer-events:none; overflow:hidden; }

/* shooting star style (used dynamically) */
.shooting-star{ position:absolute; width:160px; height:2px; background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0)); opacity:0; }

/* =========================
   CONTROLS (global)
   ========================= */
.controls{ position:fixed; right:12px; top:12px; display:flex; gap:8px; z-index:1200; }
.btn{ padding:8px 12px; border-radius:10px; border:none; background:var(--accent); color:white; cursor:pointer; font-size:1rem; white-space:nowrap; }
.btn.small{ padding:6px 8px; font-size:.88rem; }

/* =========================
   SECTIONS (panels)
   - absolutely positioned full-screen panels
   - opacity transitions between panels for smoothness
   ========================= */
.section{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px; box-sizing:border-box;
  opacity:0; pointer-events:none; transition:opacity .28s ease; }
.section.active{ opacity:1; pointer-events:auto; }
h1{ margin:28px 0 16px; font-size:1.5rem; }

/* make content scrollable within the panel if needed (rare) */
.panel-body{ width:100%; max-width:920px; margin:0 auto; }

/* =========================
   LANDING - buttons anchored low
   ========================= */
#landing { justify-content:flex-start; padding-top:8vh; }
#landingTitle { margin-top:2vh; }
#landingButtons{
  position:fixed; left:50%; transform:translateX(-50%); bottom:18vh; display:flex; gap:12px; z-index:1500;
  width:92%; max-width:420px; justify-content:center; padding:6px; box-sizing:border-box;
}
#landingButtons .btn{ flex:0 1 auto; padding:12px 18px; font-size:1rem; }
#landingButtons.reversed{ flex-direction:row-reverse; }
.btn.bigger{ transform:scale(1.12); transition:transform .18s ease; }

/* =========================
   GIFS - stacked vertical layout
   ========================= */
#gifts { padding-top:10vh; }
#giftStack{ display:flex; flex-direction:column; gap:14px; align-items:center; margin-top:6vh; }
#giftStack .btn{ width:86%; max-width:360px; text-align:center; padding:12px 18px; font-size:1rem; }

/* =========================
   Story & Letter display containers
   - story: typewriter, one paragraph at a time
   - letter: fade in/out
   ========================= */
.story-active, .letter-active{ max-width:920px; margin:0 auto; text-align:left; line-height:1.55; font-size:1.05rem; padding:10px; background:transparent; }
.story-active::after{ content:""; display:inline-block; width:8px; height:1.05em; margin-left:6px; background:var(--text); animation: blink 900ms steps(1) infinite; }
@keyframes blink{ 50%{ background:transparent; } }

/* finish button placement */
.finish-button{ margin-top:18px; }

/* =========================
   MEMORY GALLERY + SLIDESHOW
   ========================= */
.gallery{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:16px; max-width:1000px; margin:12px auto; }
.memory-item{ background:var(--card-bg); padding:12px; border-radius:10px; }
.memory-item img{ width:100%; border-radius:8px; display:block; }

.slideshow{ width:100%; max-width:980px; margin:18px auto; aspect-ratio:9/16; background:#000; border-radius:12px; overflow:hidden; position:relative; box-shadow:0 18px 36px rgba(0,0,0,0.24); }
.slide-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transform:scale(1); transition:opacity 1s ease, transform 7s ease; }
.slide-img.show{ opacity:1; transform:scale(1.03); }
.slide-verse{ position:absolute; left:50%; bottom:34px; transform:translate(-150%,0); color:white; background: linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.45)); padding:10px 16px; border-radius:18px; font-size:1rem; max-width:86%; text-align:center; transition:transform .9s ease, opacity .9s ease; opacity:0; }
.slide-verse.show{ transform:translate(-50%,0); opacity:1; }
.slideshow .loader{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#fff; font-size:1rem; background: linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.28)); }

/* overlay when all viewed */
.overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:900; background: linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.35)); visibility:hidden; opacity:0; transition:opacity .28s, visibility .28s; pointer-events:none; }
.overlay.show{ visibility:visible; opacity:1; pointer-events:auto; }
.heart-svg{ width:64px; height:64px; fill:var(--heart-pink); animation: heart-bob 2s ease-in-out infinite; }
@keyframes heart-bob{ 0%{ transform: translateY(0) scale(1);} 50%{ transform: translateY(-16px) scale(1.04);} 100%{ transform: translateY(0) scale(1); } }

/* responsive */
@media (max-width:520px){
  #landingButtons{ bottom:16vh; gap:10px; }
  #giftStack .btn{ width:92%; font-size:0.98rem; padding:12px 14px; }
}
</style>
</head>
<body>

<!-- BACKGROUND LAYERS -->
<div class="bg-layer" aria-hidden="true">
  <div id="bgSunset" class="bg-sunset"></div>
  <div id="bgNight" class="bg-night"></div>
</div>

<!-- PARTICLES (hearts / stars) -->
<div id="particles" class="particles" aria-hidden="true"></div>

<!-- GLOBAL CONTROLS -->
<div class="controls" style="z-index:1200;">
  <button class="btn small" id="themeToggle">Theme</button>
  <button class="btn small" id="muteToggle">Mute / Play</button>
</div>

<!-- INTRO: choose play or skip (first screen) -->
<div id="intro" class="section active" aria-hidden="false">
  <h1>I made something special for you ‚ù§Ô∏è</h1>
  <div class="panel-body">
    <p style="max-width:760px;margin:0 auto 18px;">
      This experience has optional intro music. Play it now or skip ‚Äî you can always mute with the control at top-right.
    </p>
    <div style="display:flex; gap:12px; justify-content:center;">
      <button class="btn" id="playIntroBtn">Play Music & Continue</button>
      <button class="btn" id="skipIntroBtn">Skip Music</button>
    </div>
  </div>
</div>

<!-- LANDING: Will you be my Valentine -->
<div id="landing" class="section" aria-hidden="true">
  <h1 id="landingTitle">Will you be my Valentine? ‚ù§Ô∏è</h1>

  <!-- buttons anchored in bottom third for mobile -->
  <div id="landingButtons" class="">
    <button id="yesBtn" class="btn">Yes</button>
    <button id="noBtn" class="btn">No</button>
  </div>
</div>

<!-- GIFTS: stacked vertical -->
<div id="gifts" class="section" aria-hidden="true">
  <h1>Choose Your Gift üéÅ</h1>
  <div id="giftStack" class="panel-body">
    <button class="btn" id="giftStoryBtn">The Story</button>
    <button class="btn" id="giftWritingBtn">Love Letter</button>
    <button class="btn" id="giftMemoriesBtn">Memories</button>
  </div>
</div>

<!-- STORY: paragraphs (unchanged text) -->
<div id="story" class="section" aria-hidden="true">
  <h1>The Story of Valentine's Day ‚ù§Ô∏è</h1>
  <div class="panel-body">
    <p>Saint.
      What is a saint? A saint can be described in many ways. Traditionally, a saint is a person who has performed miracles or has been recognized for their service, beatified, and elevated among fellow men for their utter devotion and obedience in fulfilling God's command and spreading the love of Jesus. (My definition: a saint is someone who loves God so deeply that their life becomes evidence of that love.)
    </p>

    <p>This is the story of a saint. Some do not know him first by the title of "saint," but by the name Valentine or just the day - Saint Valentine. Whether he was a man or a legend, does not make his story any less meaningful. For his story teaches us a very important lesson about love and about serving God.</p>

    <p>According to what i could piece together:Valentine is believed to have lived during the third century in Rome.He lived under the rule of Emperor Claudius II. It was a time of persecution and unrest. Claudius, believing that single men made better soldiers(madman this man), outlawed marriage for young men. But Valentine, a Christian priest, saw marriage as sacred before God.Against the laws of the Empire, he continued to perform marriages in secret. To love in such a way ‚Äî in such a time ‚Äî was dangerous. To serve Christ publicly was condemned  and punishable even. Yet he chose obedience to God over obedience to fear and the Empire that shuned God.</p>

    <p>Eventually, Valentine was caught and sentenced to death. Some tales say that while imprisoned, he ministered even to his jailer and prayed for his household. On the day of his execution, it is said he left behind a note signed, "From your Valentine." His life ended, but his witness did not. His story reminds us that love rooted in Christ is courageous, sacrificial, and enduring. As Scripture says: "But if you suffer as a Christian, do not be ashamed, but praise God that you bear that name." ‚Äî 1 Peter 4:16.</p>

    <button class="btn finish-button" id="finishStoryBtn" style="display:none">Finish</button>
  </div>
</div>

<!-- WRITING: love letter (unchanged) -->
<div id="writing" class="section" aria-hidden="true">
  <h1>My Valentines Love Letter üíå</h1>
  <div class="panel-body">
    <p>Hey, hey, hey, my love. I just wanted to say, meeting you was amazing, and it always will be one of those impressively catalytic moments of my life(you quickly pushed my life in a different direction). Some things I probably would have still gotten, but when I had you, when I was with you, they just added to the moments. My friendships, my renewed relationship with my mom ‚Äî everything ‚Äî it's just renewing the moments, and I want to thank you for that.
    </p>

    <p>When you asked that we be in a Godly relationship where we put God first and center, you helped me in a way that I didn't know I needed to be helped. Because after a while, I couldn't pretend. I couldn't pretend. I asked myself, wait, what does this mean? Because I saw you were serious, and I said, no ‚Äî in order to be with this person, I have to be serious, which means two weeks down the line, I can't be faking. And within a few days, I was in there. When we were sharing verses, I made sure to read the parts before the quote, the parts after the quote, to at least try to get it into my head. And without thinking about it, by doing that, by putting in that extra effort, I had already stopped acting from the beginning.</p>

    <p>When i first thought about joining the choir,I also felt, maybe this isn't just an opportunity to travel freely around the country, but it's also an opportunity to maximize the time I can spend with my girl and regain a skill I think I've lost. Regain and evolve ‚Äî with music, with relationships, with people, with connections. I want to thank you for all the love letters, all the recordings, the songs you sang for me. I want to thank you for saying yes to the coffee. I want to thank you for the time you got me food when I was at school. I want to thank you for the time you sang for me after my horrible Java exam. I want to thank you for worrying about me when I don't get enough sleep, when I'm tired, or when I feel uneasy.</p>

    <p>I want to thank you for loving me and for continuing to love me. And I want to say: I am going to be with you for as long as God will give us life, and if you want me forever, I am here forever. I will always be there for you. I may be one of the first to correct you, but I also want to always be one of the first ones to forgive you. I love you with all my heart, as much as my heart can bear ‚Äî and for you, I will exercise it and use it to its fullest potential.</p>

    <p>I love you because we are not afraid. I don't want you to be afraid to lean on me. I will not break. If you're sad, please continue to come to me. If you're happy, please continue to come to me too ‚Äî and every other feeling in between. While everything starts and ends with God, and I respect it and encourage it, I would also like to be reliable to you forever and ever.
    Songbird,Lioness,CEO,Bosslady,My Wife,Augustina,Mphi,baby,honey,MINE! YOU HAVE MADE ME A BETTER MAN, STAND PROUD YOU HAVE CHANGED MY LIFE!!</p>

    <button class="btn finish-button" id="finishLetterBtn" style="display:none">Finish</button>
  </div>
</div>

<!-- MEMORIES: gallery and slideshow -->
<div id="memories" class="section" aria-hidden="true">
  <h1>Our Memories üíñ</h1>
  <div id="memoryGallery" class="gallery panel-body">
    <!-- YOUR ORIGINAL gallery items (unchanged, filenames preserved) -->
    <div class="memory-item"><img src="IMG1.jpg" loading="lazy"><p>"You are altogether beautiful, my darling; there is no flaw in you." ‚Äî Song of Songs 4:7</p></div>
    <div class="memory-item"><img src="IMG2.jpg" loading="lazy"><p>"She is clothed with strength and dignity; she can laugh at the days to come." ‚Äî Proverbs 31:25</p></div>
    <div class="memory-item"><img src="IMG3.jpg" loading="lazy"><p>"The Lord bless you and keep you; the Lord make His face shine upon you." ‚Äî Numbers 6:24‚Äì26</p></div>
    <div class="memory-item"><img src="IMG4.jpg" loading="lazy"><p>"Charm is deceptive, and beauty is fleeting; but a woman who fears the Lord is to be praised." ‚Äî Proverbs 31:30</p></div>
    <div class="memory-item"><img src="IMG5.jpg" loading="lazy"><p>"Many women do noble things, but you surpass them all." ‚Äî Proverbs 31:29</p></div>
    <div class="memory-item"><img src="IMG6.jpg" loading="lazy"><p>"The Lord your God is with you, the Mighty Warrior who saves." ‚Äî Zephaniah 3:17</p></div>
    <div class="memory-item"><img src="IMG7.jpg" loading="lazy"><p>"Delight yourself in the Lord, and He will give you the desires of your heart." ‚Äî Psalm 37:4</p></div>
    <div class="memory-item"><img src="IMG8.jpg" loading="lazy"><p>"You are precious and honored in My sight‚Ä¶ and I love you." ‚Äî Isaiah 43:4</p></div>
    <div class="memory-item"><img src="IMG9.jpg" loading="lazy"><p>"Her ways are ways of pleasantness, and all her paths are peace." ‚Äî Proverbs 3:17</p></div>
    <div class="memory-item"><img src="IMG10.jpg" loading="lazy"><p>"Strength and honor are her clothing." ‚Äî Proverbs 31:25</p></div>
    <div class="memory-item"><img src="IMG11.jpg" loading="lazy"><p>"The Lord delights in those who fear Him, who put their hope in His unfailing love." ‚Äî Psalm 147:11</p></div>
    <div class="memory-item"><img src="IMG13.jpg" loading="lazy"><p>"Commit your way to the Lord; trust in Him and He will act." ‚Äî Psalm 37:5</p></div>
    <div class="memory-item"><img src="IMG14.jpg" loading="lazy"><p>"Let your light shine before others." ‚Äî Matthew 5:16</p></div>
    <div class="memory-item"><img src="IMG15.jpg" loading="lazy"><p>"Grace is poured upon your lips." ‚Äî Psalm 45:2</p></div>
    <div class="memory-item"><img src="IMG16.jpg" loading="lazy"><p>"The Lord will guide you continually." ‚Äî Isaiah 58:11</p></div>

    <div class="memory-item"><img src="IMG12.jpg" loading="lazy"><p>"Two are better than one‚Ä¶ If either of them falls down, one can help the other up." ‚Äî Ecclesiastes 4:9‚Äì10</p></div>
    <div class="memory-item"><img src="IMG17.jpg" loading="lazy"><p>"Above all, love each other deeply, because love covers over a multitude of sins." ‚Äî 1 Peter 4:8</p></div>
    <div class="memory-item"><img src="IMG18.jpg" loading="lazy"><p>"I thank my God every time I remember you." ‚Äî Philippians 1:3</p></div>
    <div class="memory-item"><img src="IMG19.jpg" loading="lazy"><p>"Let love and faithfulness never leave you." ‚Äî Proverbs 3:3</p></div>
    <div class="memory-item"><img src="IMG20.jpg" loading="lazy"><p>"Therefore what God has joined together, let no one separate." ‚Äî Mark 10:9</p></div>
  </div>

  <div id="slideshow" class="slideshow" aria-hidden="true"></div>

  <div style="margin-top:12px; text-align:center;">
    <button id="importBtn" class="btn" style="display:none">Import images from device</button>
    <input id="fileInput" type="file" accept="image/*" multiple style="display:none"/>
  </div>

  <button class="btn finish-button" id="finishMemoriesBtn" style="display:none">Finish</button>
</div>

<!-- END overlay -->
<div id="endOverlay" class="overlay" role="dialog" aria-hidden="true">
  <div style="text-align:center;color:white;">
    <svg class="heart-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21s-7.5-4.5-9.1-6A5.6 5.6 0 0 1 2.5 7.6 5.4 5.4 0 0 1 8 3c1.8 0 3.1 1 4 2 0.9-1 2.2-2 4-2a5.4 5.4 0 0 1 5.5 4.6c0 0 0 .2 0 .2-1.1 6.6-9.4 12.4-12.4 14.2z"/></svg>
    <div style="margin-top:12px; font-size:1.05rem;">Thanks for reading ‚Äî I hope you enjoyed it ‚ù§Ô∏è</div>
    <div style="margin-top:12px;">
      <button class="btn" id="shareBtn">Share / Finish</button>
    </div>
  </div>
</div>

<!-- AUDIO placeholders -->
<audio id="introMusic" loop><source src="Intro.mp3" type="audio/mpeg"></audio>
<audio id="storyMusic" loop><source src="Story.mp3" type="audio/mpeg"></audio>
<audio id="writingMusic" loop><source src="Writing.mp3" type="audio/mpeg"></audio>
<audio id="memoriesMusic" loop><source src="Memories.mp3" type="audio/mpeg"></audio>

<script>
/* ========= Utilities ========= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const rand = (a,b) => Math.random()*(b-a)+a;

/* ========= Core nav & music ========= */
let currentMusic = null;
function stopAllMusic(){ 
  $$('audio').forEach(a=>{ 
    try{ 
      a.pause(); 
      a.currentTime=0; 
    }catch(e){} 
  }); 
  currentMusic=null; 
}

function playMusic(section){ 
  stopAllMusic(); 
  const el = document.getElementById(section+'Music'); 
  if(el){ 
    currentMusic = el; 
    el.play().catch(()=>{}); 
  } 
}

function toggleMusic(){ 
  if(currentMusic) {
    currentMusic.muted = !currentMusic.muted; 
  }
}

/* showSection: manage panel visibility and landing buttons */
function showSection(id){
  // Hide all sections
  $$('.section').forEach(s => { 
    s.classList.remove('active'); 
    s.setAttribute('aria-hidden','true'); 
  });
  
  // Show requested section
  const sec = document.getElementById(id);
  if(!sec) return;
  sec.classList.add('active'); 
  sec.setAttribute('aria-hidden','false');
  
  // Manage landing buttons visibility
  const landingButtons = $('#landingButtons');
  if(id === 'landing'){
    landingButtons.style.display = 'flex';
  } else {
    landingButtons.style.display = 'none';
  }
  
  // Start appropriate music
  if(id === 'landing') playMusic('intro');
  else if(id === 'story') playMusic('story');
  else if(id === 'writing') playMusic('writing');
  else if(id === 'memories') playMusic('memories');
}

/* gift tracking */
let viewedGifts = { story:false, writing:false, memories:false };

function checkAllViewed(){
  if(viewedGifts.story && viewedGifts.writing && viewedGifts.memories){
    setTimeout(()=>{ showEndOverlay(); }, 500);
  }
}

function completeGift(id){
  viewedGifts[id] = true;
  showSection('gifts');
  checkAllViewed();
}

/* initial view: intro */
showSection('intro');

/* ========= Background particles (hearts / stars + shooting) ========= */
const particles = document.getElementById('particles');
function clearParticles(){ particles.innerHTML = ''; }

function createEmojiHearts(n){
  for(let i=0;i<n;i++){
    const d = document.createElement('div');
    d.textContent = 'üíó';
    d.style.position = 'absolute';
    d.style.left = rand(2,95) + '%';
    d.style.top = rand(8,72) + '%';
    d.style.fontSize = Math.round(rand(18,36)) + 'px';
    d.style.opacity = rand(0.55,0.95);
    particles.appendChild(d);
    d.animate([
      { transform:'translateY(0)' }, 
      { transform:'translateY(-12px)' }, 
      { transform:'translateY(0)' }
    ], { 
      duration: rand(6000,12000), 
      iterations: Infinity, 
      direction:'alternate' 
    });
  }
}

function createStars(n){
  for(let i=0;i<n;i++){
    const s = document.createElement('div');
    s.textContent = '‚ú¶'; 
    s.style.position='absolute';
    s.style.left = rand(2,98) + '%'; 
    s.style.top = rand(2,98) + '%';
    s.style.fontSize = Math.round(rand(10,20)) + 'px'; 
    s.style.opacity = rand(0.25,0.9); 
    s.style.color = 'white';
    particles.appendChild(s);
  }
}

function createShootingStars(n){
  for(let i=0;i<n;i++){
    const el = document.createElement('div');
    el.className = 'shooting-star';
    el.style.left = '-30%';
    el.style.top = rand(6,44) + '%';
    particles.appendChild(el);
    setTimeout(()=> animateShooting(el), rand(400,2600));
  }
}

function animateShooting(el){
  el.style.transition = 'transform 1.1s linear, opacity .4s linear';
  el.style.transform = 'translate(140vw,80vh) rotate(22deg)'; 
  el.style.opacity = 1;
  setTimeout(()=>{ 
    el.style.opacity = 0; 
    el.style.transform = 'translate(-200px,-100px) rotate(22deg)'; 
    setTimeout(()=> animateShooting(el), rand(3500,10000)); 
  }, 1100);
}

function updateBackgroundMode(){
  const night = document.body.classList.contains('dark');
  $('#bgNight').style.opacity = night ? '1' : '0';
  $('#bgSunset').style.opacity = night ? '0' : '1';
  clearParticles();
  if(night){ 
    createStars(48); 
    createShootingStars(3); 
  } else { 
    createEmojiHearts(12); 
  }
}

updateBackgroundMode();

/* ======= Theme & control wiring ======= */
$('#themeToggle').addEventListener('click', ()=>{ 
  document.body.classList.toggle('dark'); 
  updateBackgroundMode(); 
});

$('#muteToggle').addEventListener('click', toggleMusic);

/* ========= Intro buttons ========= */
$('#playIntroBtn').addEventListener('click', ()=>{ 
  const intro = $('#introMusic'); 
  intro.play().catch(()=>{}); 
  currentMusic = intro; 
  showSection('landing'); 
});

$('#skipIntroBtn').addEventListener('click', ()=>{ 
  showSection('landing'); 
});

/* ========= Landing Yes/No logic ========= */
const yesBtn = $('#yesBtn');
const noBtn = $('#noBtn');
const landingButtons = $('#landingButtons');
let noPressCount = 0;
let noSquaredActive = false;

yesBtn.addEventListener('click', (e)=>{ 
  e.stopPropagation(); 
  showSection('gifts');
});

noBtn.addEventListener('click', (e)=>{ 
  e.stopPropagation(); 
  handleNoPress(); 
});

function handleNoPress(){
  if(noSquaredActive){
    alert("No¬≤ = yes ‚ù§Ô∏è"); 
    showSection('gifts'); 
    return;
  }
  
  noPressCount++;
  
  if(noPressCount === 1){
    alert("I think you meant 'Yes' üòâ");
  } else if(noPressCount === 2){
    yesBtn.classList.add('bigger'); 
    setTimeout(()=> yesBtn.classList.remove('bigger'), 900);
  } else if(noPressCount === 3){
    landingButtons.classList.toggle('reversed');
  } else if(noPressCount >= 4){
    noBtn.textContent = 'No¬≤'; 
    noSquaredActive = true; 
    noBtn.classList.add('bigger'); 
    setTimeout(()=> noBtn.classList.remove('bigger'), 700);
  }
}

/* ========= Gifts buttons ========= */
$('#giftStoryBtn').addEventListener('click', ()=> {
  showSection('story');
  if(window.startStorySequence) window.startStorySequence();
});

$('#giftWritingBtn').addEventListener('click', ()=> {
  showSection('writing');
  if(window.startLetterSequence) window.startLetterSequence();
});

$('#giftMemoriesBtn').addEventListener('click', ()=> {
  showSection('memories');
  if(window.startMemoriesSequence) window.startMemoriesSequence();
});

/* ========= Story typewriter mechanic ========= */
(function setupStory(){
  const storySection = $('#story');
  const paras = Array.from(storySection.querySelectorAll('p')).map(p=>p.innerText);
  storySection.querySelectorAll('p').forEach(p=>p.style.display='none');
  const finishBtn = $('#finishStoryBtn'); 
  finishBtn.style.display = 'none';
  
  const display = document.createElement('div'); 
  display.className = 'story-active';
  storySection.querySelector('.panel-body').insertBefore(display, finishBtn);
  
  let idx = 0;
  let char = 0;
  let typing = false;
  let speed = 18;
  
  function typeNext(){
    typing = true; 
    display.innerHTML = ''; 
    char = 0; 
    const text = paras[idx] || '';
    
    (function step(){ 
      if(char < text.length){ 
        display.innerHTML += text.charAt(char++); 
        setTimeout(step, speed); 
      } else {
        typing = false; 
      }
    })();
  }
  
  window.startStorySequence = function(){ 
    idx = 0; 
    finishBtn.style.display = 'none'; 
    typeNext(); 
  };
  
  storySection.addEventListener('click', (ev)=>{ 
    if(ev.target.tagName === 'BUTTON') return; 
    if(typing) return; 
    
    idx++; 
    if(idx < paras.length) {
      typeNext(); 
    } else {
      finishBtn.style.display = 'inline-block'; 
    }
  });
  
  finishBtn.addEventListener('click', ()=> { 
    finishBtn.style.display='none'; 
    completeGift('story'); 
  });
})();

/* ========= Letter fade mechanic ========= */
(function setupLetter(){
  const sec = $('#writing');
  const paras = Array.from(sec.querySelectorAll('p')).map(p=>p.innerText);
  sec.querySelectorAll('p').forEach(p=>p.style.display='none');
  
  const finishBtn = $('#finishLetterBtn'); 
  finishBtn.style.display = 'none';
  
  const container = document.createElement('div'); 
  container.style.maxWidth='920px'; 
  container.style.margin='0 auto'; 
  container.style.textAlign='left';
  sec.querySelector('.panel-body').insertBefore(container, finishBtn);
  
  let idx = 0;
  let busy = false;
  
  function show(i){
    container.innerHTML = '';
    const el = document.createElement('div'); 
    el.className = 'letter-active'; 
    el.style.opacity = '0'; 
    el.style.transition = 'opacity .6s ease';
    el.innerText = paras[i] || '';
    container.appendChild(el);
    requestAnimationFrame(()=> el.style.opacity = '1');
    busy = false;
  }
  
  window.startLetterSequence = function(){ 
    idx = 0; 
    finishBtn.style.display = 'none'; 
    show(0); 
  };
  
  sec.addEventListener('click', (ev)=>{ 
    if(ev.target.tagName === 'BUTTON') return; 
    if(busy) return; 
    
    busy = true; 
    const cur = container.querySelector('.letter-active'); 
    if(!cur){ 
      busy=false; 
      return; 
    } 
    
    cur.style.opacity = '0'; 
    setTimeout(()=>{ 
      idx++; 
      if(idx < paras.length) {
        show(idx); 
      } else { 
        finishBtn.style.display = 'inline-block'; 
        busy=false; 
      } 
    }, 620); 
  });
  
  finishBtn.addEventListener('click', ()=> { 
    finishBtn.style.display='none'; 
    completeGift('writing'); 
  });
})();

/* ========= Memories slideshow + importer (7s per slide) ========= */
(function setupMemories(){
  const gallery = $('#memoryGallery');
  const items = Array.from(gallery.querySelectorAll('.memory-item'));
  const slideshow = $('#slideshow');
  const finishBtn = $('#finishMemoriesBtn');
  const importBtn = $('#importBtn');
  const fileInput = $('#fileInput');

  // build slides from DOM
  let slides = items.map(it => {
    const img = it.querySelector('img'); 
    const p = it.querySelector('p');
    return { 
      src: img ? img.getAttribute('src') : '', 
      verse: p ? p.innerText : '' 
    };
  });

  slideshow.style.display = 'none'; 
  finishBtn.style.display = 'none'; 
  importBtn.style.display = 'none';

  function preloadAll(srcs){
    return Promise.all(srcs.map((s, idx) => new Promise(res => {
      if(!s){ 
        res({ok:false, idx}); 
        return; 
      }
      const im = new Image();
      im.onload = () => res({ok:true, idx});
      im.onerror = () => res({ok:false, idx});
      im.src = s;
    })));
  }

  function resizeImageFile(file, maxDim = 1600, quality = 0.78){
    return new Promise(res => {
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = () => {
        let w = img.naturalWidth, h = img.naturalHeight;
        const ratio = w/h;
        if(Math.max(w,h) > maxDim){
          if(w >= h){ 
            w = maxDim; 
            h = Math.round(w/ratio); 
          } else { 
            h = maxDim; 
            w = Math.round(h*ratio); 
          }
        }
        const canvas = document.createElement('canvas'); 
        canvas.width = w; 
        canvas.height = h;
        const ctx = canvas.getContext('2d'); 
        ctx.drawImage(img, 0, 0, w, h);
        canvas.toBlob(blob => {
          const reader = new FileReader();
          reader.onloadend = () => { 
            res(reader.result); 
            URL.revokeObjectURL(url); 
          };
          reader.readAsDataURL(blob);
        }, 'image/jpeg', quality);
      };
      img.onerror = () => { 
        URL.revokeObjectURL(url); 
        res(null); 
      };
      img.src = url;
    });
  }

  async function tryPreloadAndMaybeImport(){
    slideshow.innerHTML = '<div class="loader">Preparing slideshow‚Ä¶</div>'; 
    slideshow.style.display = 'block';
    
    const srcs = slides.map(s=>s.src);
    const results = await preloadAll(srcs);
    const okCount = results.filter(r=>r.ok).length;
    
    if(okCount === 0){
      slideshow.innerHTML = '<div class="loader">Images not loading. You can import photos from your device to continue.</div>';
      importBtn.style.display = 'inline-block';
      importBtn.onclick = ()=> fileInput.click();
    } else {
      importBtn.style.display = 'none';
      startShowSequence();
    }
  }

  let idx = 0;
  let timer = null;
  
  async function showSlide(i){
    if(!slides[i]) return;
    
    slideshow.innerHTML = '';
    const loader = document.createElement('div'); 
    loader.className = 'loader'; 
    loader.innerText = 'Loading‚Ä¶';
    
    const img = document.createElement('img'); 
    img.className = 'slide-img';
    
    const verse = document.createElement('div'); 
    verse.className = 'slide-verse'; 
    verse.innerText = slides[i].verse || '';
    
    slideshow.appendChild(loader); 
    slideshow.appendChild(img); 
    slideshow.appendChild(verse);

    let shown = false;
    img.onload = ()=> { 
      shown = true; 
      if(loader.parentNode) loader.remove(); 
      img.classList.add('show'); 
      verse.classList.add('show'); 
    };
    img.onerror = ()=> { 
      shown = true; 
      if(loader.parentNode) loader.remove(); 
      img.classList.add('show'); 
      verse.classList.add('show'); 
    };
    img.src = slides[i].src || '';

    setTimeout(()=>{ 
      if(!shown){ 
        if(loader.parentNode) loader.remove(); 
        img.classList.add('show'); 
        verse.classList.add('show'); 
      } 
    }, 700);

    // 7s total per slide
    const visibleMs = 6000;
    const fadeMs = 1000;
    
    timer = setTimeout(()=>{ 
      img.classList.remove('show'); 
      verse.classList.remove('show'); 
      
      setTimeout(()=>{ 
        idx++; 
        if(idx < slides.length){ 
          showSlide(idx); 
        } else { 
          slideshow.style.display = 'none'; 
          finishBtn.style.display = 'inline-block'; 
        } 
      }, fadeMs); 
    }, visibleMs);
  }

  function startShowSequence(){ 
    idx = 0; 
    finishBtn.style.display = 'none'; 
    slideshow.style.display = 'block'; 
    showSlide(0); 
  }

  fileInput.addEventListener('change', async (ev)=>{
    const files = Array.from(ev.target.files).slice(0,20);
    if(files.length === 0) return;
    
    slideshow.innerHTML = '<div class="loader">Resizing images‚Ä¶</div>';
    const dataUrls = [];
    
    for(const f of files){
      const resized = await resizeImageFile(f, 1600, 0.78);
      if(resized) dataUrls.push(resized);
    }
    
    if(dataUrls.length > 0){
      slides = dataUrls.map((d,i)=> ({ 
        src:d, 
        verse: (items[i] && items[i].querySelector('p')) ? items[i].querySelector('p').innerText : '' 
      }));
      gallery.style.display = 'none';
      importBtn.style.display = 'none';
      startShowSequence();
    } else {
      slideshow.innerHTML = '<div class="loader">Import failed. Try different images.</div>';
    }
  });

  window.startMemoriesSequence = function(){
    gallery.style.display = 'none';
    importBtn.style.display = 'none';
    finishBtn.style.display = 'none';
    tryPreloadAndMaybeImport();
  };

  window.stopMemoriesSequence = function(){
    if(timer) clearTimeout(timer);
    slideshow.style.display = 'none'; 
    gallery.style.display = '';
    finishBtn.style.display = 'none';
  };

  finishBtn.addEventListener('click', ()=> { 
    finishBtn.style.display = 'none'; 
    completeGift('memories'); 
  });
})();

/* ========= End overlay & share ========= */
const overlay = $('#endOverlay');

function showEndOverlay(){ 
  overlay.classList.add('show'); 
  overlay.setAttribute('aria-hidden','false'); 
}

$('#shareBtn').addEventListener('click', ()=> {
  overlay.classList.remove('show'); 
  overlay.setAttribute('aria-hidden','true');
  
  if(navigator.share){ 
    navigator.share({ 
      title:'For You ‚ù§Ô∏è', 
      text:'I wanted to share something special with you...', 
      url: window.location.href 
    }).catch(()=>{}); 
  }
});

/* ensure background set correctly at start */
updateBackgroundMode();
</script>
</body>
</html>